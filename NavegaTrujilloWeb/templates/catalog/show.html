{% extends 'base_template.html' %}

{% block title %}
<h1 class="ship-show-title">{{ ship.name }}</h1>
{% endblock %}

{% block main %}

<script>
    function addCookieItem(shipId, action){
        console.log('User is not authenticated');

        if (action == 'add') {
            if (cart[shipId] == undefined) {
                cart[shipId] = {'quantity': 1};
            } else {
                cart[shipId]['quantity'] = 1;
            }
        }

        if (action == 'remove') {
            cart[shipId]['quantity'] = 0;

            if (cart[shipId]['quantity'] <= 0) {
                console.log('Item should be deleted');
                delete cart[shipId];
            }
        }
        console.log('CART:', cart);
        document.cookie = 'cart=' + JSON.stringify(cart) + ";domain=;path=/";
        location.reload();
    }
</script>

{% load static %}

<link rel="stylesheet" href="{% static 'css/show.css' %}" type="text/css">

<body class="ship-show-page">
    <div class="ship-show-container">
        <!-- Título del Barco -->
        

        <!-- En caso de que sea admin, devuelve el formulario para cambiar los datos -->
        {% if request.user.is_staff and form %}
        <form action="" method="post" class="ship-show-card">
            {% csrf_token %}
            {{ ship_form }}
            <input type="submit" value="Actualizar" class="ship-show-button-action">
        </form>
        {% else %}
        <div class="ship-show-card">
            <div class="ship-show-card-body">
                <!-- Tabla con la información del barco -->
                <table class="ship-show-table">
                    <thead>
                        <tr>
                            <th>Disponibilidad</th>
                            <th>Precio por día</th>
                            <th>Capacidad máxima</th>
                            <th>¿Necesitas licencia o capitán?</th>
                            <th>Puerto</th>
                            <th>Descripción</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="ship-show-data-column">{% if ship.available %} Disponible {% else %} No disponible {% endif %}</td>
                            <td class="ship-show-data-column">{{ ship.rent_per_day }} €</td>
                            <td class="ship-show-data-column">{{ ship.capacity }} personas</td>
                            <td class="ship-show-data-column">{% if ship.needs_license %} Sí {% else %} No {% endif %}</td>
                            <td class="ship-show-data-column">{{ ship.port.ubication }}</td>
                            <td class="ship-show-data-column">{{ ship.description }}</td>
                        </tr>
                    </tbody>
                </table>
                <h3 class="ship-show-note">Nota: La tarifa de un capitán es de 120 euros/día</h3>
                <div>
                    {% if shipInCart %}
                    <button class="ship-show-button-action" onclick="addCookieItem('{{ ship.id }}', 'remove')">Quitar del carrito</button>
                    {% else %}
                    <button class="ship-show-button-action" onclick="addCookieItem('{{ ship.id }}', 'add')">Agregar al carrito</button>
                    {% endif %}
                </div>
            </div>
            <!-- Formulario de reserva -->
            <form action={% if request.user.is_authenticated %} "../../../reserva/{{ ship.id }}" {% else %} "reserva" {% endif %} method="post">
                {% csrf_token %}
                {{ reservation_form }}
                <input type="submit" class="ship-show-button-action" value="Reservar">
            </form>
        </div>
        <!-- Placeholder para la imagen del barco -->
        <div class="ship-show-image">
            Placeholder imagen
        </div>
        {% endif %}
    </div>
</body>

<script>
    window.onload = function() {
        document.getElementById("id_captain").labels[0].innerHTML = "Capitán";
    }
</script>

{% endblock %}
